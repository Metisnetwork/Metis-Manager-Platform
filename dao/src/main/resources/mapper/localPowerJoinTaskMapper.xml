<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platon.metis.admin.dao.LocalPowerJoinTaskMapper">

  <resultMap id="BaseResultMap" type="com.platon.metis.admin.dao.entity.LocalPowerJoinTask">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="power_node_id" jdbcType="VARCHAR" property="powerNodeId" />
    <result column="task_id" jdbcType="VARCHAR" property="taskId" />
    <result column="task_name" jdbcType="VARCHAR" property="taskName" />
    <result column="owner_identity_id" jdbcType="VARCHAR" property="ownerIdentityId" />
    <result column="owner_identity_name" jdbcType="VARCHAR" property="ownerIdentityName" />
    <result column="task_start_time" jdbcType="TIMESTAMP" property="taskStartTime" />
    <result column="result_side_id" jdbcType="VARCHAR" property="resultSideId" />
    <result column="result_side_name" jdbcType="VARCHAR" property="resultSideName" />
    <result column="coordinate_side_id" jdbcType="VARCHAR" property="coordinateSideId" />
    <result column="coordinate_side_name" jdbcType="VARCHAR" property="coordinateSideName" />
    <result column="used_memory" jdbcType="BIGINT" property="usedMemory" />
    <result column="used_core" jdbcType="INTEGER" property="usedCore" />
    <result column="used_bandwidth" jdbcType="BIGINT" property="usedBandwidth" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>

  <sql id="Base_Column_List">
    id,
    power_node_id,
    task_id,
    task_name,
    owner_identity_id,
    owner_identity_name,
    task_start_time,
    result_side_id,
    result_side_name,
    coordinate_side_id,
    coordinate_side_name,
    used_memory,
    used_core,
    used_bandwidth,
    create_time,
    update_time
  </sql>

  <!-- 通过计算节点参数任务详情 -->
  <!--<select id="listRunningTaskByPowerNodeId" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
        <include refid="Base_Column_List" />
    from
        local_power_join_task
    where
        power_node_id = #{powerNodeId, jdbcType=VARCHAR}
    order by task_start_time desc
  </select>-->


  <insert id="insertBatch">
    insert into local_power_join_task (
    power_node_id,
    task_id,
    task_name,
    owner_identity_id,
    owner_identity_name,
    task_start_time,
    result_side_id,
    result_side_name,
    coordinate_side_id,
    coordinate_side_name,
    used_memory,
    used_core,
    used_bandwidth)
    values
    <foreach collection ="localPowerJoinTaskList" item="item" separator =",">
      (#{item.powerNodeId, jdbcType=VARCHAR},
       #{item.taskId, jdbcType=VARCHAR},
       #{item.taskName, jdbcType=VARCHAR},
       #{item.ownerIdentityId, jdbcType=VARCHAR},
       #{item.ownerIdentityName, jdbcType=VARCHAR},
       #{item.taskStartTime, jdbcType=TIMESTAMP},
      #{item.resultSideId, jdbcType=VARCHAR},
      #{item.resultSideName, jdbcType=VARCHAR},
      #{item.coordinateSideId, jdbcType=VARCHAR},
      #{item.coordinateSideName, jdbcType=VARCHAR},
      #{item.usedMemory, jdbcType=BIGINT},
      #{item.usedCore, jdbcType=INTEGER},
      #{item.usedBandwidth, jdbcType=BIGINT}
       )
    </foreach>
  </insert>

  <!-- 清空表数据-->
  <update id="truncateTable">
    truncate table local_power_join_task
  </update>

</mapper>